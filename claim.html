<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Nh·∫≠n Coin Th√†nh C√¥ng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="status-message">ƒêang x·ª≠ l√Ω v√† c·ªông Coin...</div>

    <script>
        async function processClaim() {
            const params = new URLSearchParams(window.location.search);
            const userId = params.get('user_id');
            const coin = params.get('coin');
            const txId = params.get('tx_id');
            const statusDiv = document.getElementById('status-message');

            if (!userId || !coin || !txId) {
                statusDiv.className = 'error';
                statusDiv.innerHTML = 'L·ªói: Thi·∫øu th√¥ng tin c·∫ßn thi·∫øt. Vui l√≤ng th·ª≠ l·∫°i t·ª´ Bot.';
                return;
            }

            try {
                // G·ªåI ƒê·∫æN API ROUTE C·ª¶A VERCEL (M·ª•c 3.2)
                const response = await fetch(`/api/process_claim?user_id=${userId}&coin=${coin}&tx_id=${txId}`);
                const data = await response.json();

                if (data.status === 'success') {
                    statusDiv.className = 'success';
                    statusDiv.innerHTML = `üéâ **C·∫£m ∆°n b·∫°n!** B·∫°n ƒë√£ nh·∫≠n th√†nh c√¥ng **${coin} Coin VIP**!`;
                } else if (response.status === 409) { // 409: Conflict (ƒë√£ claim)
                    statusDiv.className = 'error';
                    statusDiv.innerHTML = `‚ö†Ô∏è **ƒê√£ x·∫£y ra l·ªói:** Giao d·ªãch n√†y (${txId}) ƒë√£ ƒë∆∞·ª£c nh·∫≠n Coin tr∆∞·ªõc ƒë√≥.`;
                } else {
                    statusDiv.className = 'error';
                    statusDiv.innerHTML = `‚ùå **L·ªói:** Kh√¥ng th·ªÉ c·ªông Coin. Th√¥ng b√°o: ${data.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh'}`;
                }
            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.innerHTML = '‚ùå **L·ªói:** Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß x·ª≠ l√Ω Coin.';
                console.error(error);
            }
        }

        processClaim();
    </script>
</body>
</html>
